"use strict";(self.webpackChunkarch_guide=self.webpackChunkarch_guide||[]).push([[7281],{7548:(s,n,a)=>{a.r(n),a.d(n,{comp:()=>t,data:()=>p});var e=a(641);const i=[(0,e.Fv)('<h1 id="minio-集群冷备数据如何恢复部署-minio-集群冷备数据如何恢复部署" tabindex="-1"><a class="header-anchor" href="#minio-集群冷备数据如何恢复部署-minio-集群冷备数据如何恢复部署"><span>Minio 集群冷备数据如何恢复部署?Minio 集群冷备数据如何恢复部署</span></a></h1><p>要在新的节点上使用冷备数据目录恢复 MinIO 并正常提供服务，需要确保 MinIO 服务能够正确识别和 使用这些数据。以下是具体步骤：</p><h3 id="_1-停止-minio-服务" tabindex="-1"><a class="header-anchor" href="#_1-停止-minio-服务"><span>1. 停止 MinIO 服务</span></a></h3><p>在新节点上开始恢复之前，需要确保 MinIO 服务已经停止运行，以防止数据不一致。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> systemctl stop minio</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-复制数据目录" tabindex="-1"><a class="header-anchor" href="#_2-复制数据目录"><span>2. 复制数据目录</span></a></h3><p>将备份的数据目录复制到新节点的 MinIO 数据目录中。例如，如果备份存储在远程服务器 <code>/path/to/backup/</code> 目录下，可以使用 <code>rsync</code> 或 <code>scp</code> 工具进行复制。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 使用 rsync 进行恢复</span></span>\n<span class="line"><span class="token function">rsync</span> <span class="token parameter variable">-avz</span> user@remote-server:/path/to/backup/ /path/to/minio/data/</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 或者使用 scp 进行恢复</span></span>\n<span class="line"><span class="token function">scp</span> <span class="token parameter variable">-r</span> user@remote-server:/path/to/backup/ /path/to/minio/data/</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-确保目录权限" tabindex="-1"><a class="header-anchor" href="#_3-确保目录权限"><span>3. 确保目录权限</span></a></h3><p>确保新节点上的 MinIO 数据目录具有正确的权限和所有者。通常，MinIO 服务运行的用户应当对该目录具有读写权限。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> minio-user:minio-user /path/to/minio/data/</span>\n<span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /path/to/minio/data/</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-配置-minio-服务" tabindex="-1"><a class="header-anchor" href="#_4-配置-minio-服务"><span>4. 配置 MinIO 服务</span></a></h3><p>确保 MinIO 服务配置文件（通常为 <code>/etc/systemd/system/minio.service</code>）中的数据目录路径与恢复后的数据目录 路径一致。如果路径有变化，需要更新配置文件。</p><p>示例 MinIO 服务配置文件：</p><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini" data-title="ini"><pre class="language-ini"><code><span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span></span>\n<span class="line"><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">MinIO</span></span>\n<span class="line"><span class="token key attr-name">Documentation</span><span class="token punctuation">=</span><span class="token value attr-value">https://docs.min.io</span></span>\n<span class="line"><span class="token key attr-name">Wants</span><span class="token punctuation">=</span><span class="token value attr-value">network-online.target</span></span>\n<span class="line"><span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network-online.target</span></span>\n<span class="line"></span>\n<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span></span>\n<span class="line"><span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">minio-user</span></span>\n<span class="line"><span class="token key attr-name">Group</span><span class="token punctuation">=</span><span class="token value attr-value">minio-user</span></span>\n<span class="line"><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/minio server /path/to/minio/data/</span></span>\n<span class="line"><span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">always</span></span>\n<span class="line"><span class="token key attr-name">RestartSec</span><span class="token punctuation">=</span><span class="token value attr-value">10s</span></span>\n<span class="line"><span class="token key attr-name">LimitNOFILE</span><span class="token punctuation">=</span><span class="token value attr-value">65536</span></span>\n<span class="line"></span>\n<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span></span>\n<span class="line"><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-启动-minio-服务" tabindex="-1"><a class="header-anchor" href="#_5-启动-minio-服务"><span>5. 启动 MinIO 服务</span></a></h3><p>启动 MinIO 服务并检查服务状态以确保其正常运行。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> systemctl start minio</span>\n<span class="line"><span class="token function">sudo</span> systemctl status minio</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-验证数据" tabindex="-1"><a class="header-anchor" href="#_6-验证数据"><span>6. 验证数据</span></a></h3><p>登录到 MinIO 控制台或使用 MinIO 客户端工具（<code>mc</code>）来验证数据是否恢复正常。</p><h4 id="使用-minio-控制台" tabindex="-1"><a class="header-anchor" href="#使用-minio-控制台"><span>使用 MinIO 控制台</span></a></h4><p>访问 MinIO 控制台（通常为 <code>http://your-minio-server:9000</code>），并使用管理凭证登录，检查数据是否完好无损。</p><h4 id="使用-minio-客户端工具-mc" tabindex="-1"><a class="header-anchor" href="#使用-minio-客户端工具-mc"><span>使用 MinIO 客户端工具（<code>mc</code>）</span></a></h4><p>安装 <code>mc</code> 客户端并配置 MinIO 别名：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">wget</span> https://dl.min.io/client/mc/release/linux-amd64/mc</span>\n<span class="line"><span class="token function">chmod</span> +x <span class="token function">mc</span></span>\n<span class="line"><span class="token function">sudo</span> <span class="token function">mv</span> <span class="token function">mc</span> /usr/local/bin/</span>\n<span class="line"></span>\n<span class="line"><span class="token function">mc</span> <span class="token builtin class-name">alias</span> <span class="token builtin class-name">set</span> myminio http://your-minio-server:9000 accessKey secretKey</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>列出所有桶和对象以确保数据恢复正常：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">mc</span> <span class="token function">ls</span> myminio/</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="示例恢复过程" tabindex="-1"><a class="header-anchor" href="#示例恢复过程"><span>示例恢复过程</span></a></h3><p>以下是一个完整的恢复过程示例：</p><ol><li><p><strong>停止 MinIO 服务</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> systemctl stop minio</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>复制数据目录</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">rsync</span> <span class="token parameter variable">-avz</span> user@remote-server:/path/to/backup/ /path/to/minio/data/</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>确保目录权限</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> minio-user:minio-user /path/to/minio/data/</span>\n<span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /path/to/minio/data/</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>配置 MinIO 服务</strong></p><p>确保 <code>/etc/systemd/system/minio.service</code> 文件中配置的路径正确：</p><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini" data-title="ini"><pre class="language-ini"><code><span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span></span>\n<span class="line"><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">MinIO</span></span>\n<span class="line"><span class="token key attr-name">Documentation</span><span class="token punctuation">=</span><span class="token value attr-value">https://docs.min.io</span></span>\n<span class="line"><span class="token key attr-name">Wants</span><span class="token punctuation">=</span><span class="token value attr-value">network-online.target</span></span>\n<span class="line"><span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network-online.target</span></span>\n<span class="line"></span>\n<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span></span>\n<span class="line"><span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">minio-user</span></span>\n<span class="line"><span class="token key attr-name">Group</span><span class="token punctuation">=</span><span class="token value attr-value">minio-user</span></span>\n<span class="line"><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/minio server /path/to/minio/data/</span></span>\n<span class="line"><span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">always</span></span>\n<span class="line"><span class="token key attr-name">RestartSec</span><span class="token punctuation">=</span><span class="token value attr-value">10s</span></span>\n<span class="line"><span class="token key attr-name">LimitNOFILE</span><span class="token punctuation">=</span><span class="token value attr-value">65536</span></span>\n<span class="line"></span>\n<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span></span>\n<span class="line"><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>启动 MinIO 服务</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> systemctl start minio</span>\n<span class="line"><span class="token function">sudo</span> systemctl status minio</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>验证数据</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">mc</span> <span class="token builtin class-name">alias</span> <span class="token builtin class-name">set</span> myminio http://your-minio-server:9000 accessKey secretKey</span>\n<span class="line"><span class="token function">mc</span> <span class="token function">ls</span> myminio/</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>通过上述步骤，可以在新的节点上使用冷备的数据目录恢复 MinIO，并确保其能够正常提供服务。关键点在于停止 MinIO 服务以确保数据一致性，正确复制数据目录，确保目录权限和服务配置无误，最后启动服务并验证数据完整性。这样，MinIO 就可以在新的节点上正常运行，并为用户提供服务。</p>',32)],l={},t=(0,a(6262).A)(l,[["render",function(s,n){return(0,e.uX)(),(0,e.CE)("div",null,i)}]]),p=JSON.parse('{"path":"/blog/minio/Minio-%E9%9B%86%E7%BE%A4%E5%86%B7%E5%A4%87%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E6%81%A2%E5%A4%8D%E9%83%A8%E7%BD%B2.html","title":"Minio 集群冷备数据如何恢复部署?Minio 集群冷备数据如何恢复部署","lang":"zh-CN","frontmatter":{"date":"2021-07-07T00:00:00.000Z","category":["Minio"],"tag":["对象存储"],"sticky":true,"excerpt":"<p> Minio 上传请求负载分析 </p>"},"headers":[{"level":3,"title":"1. 停止 MinIO 服务","slug":"_1-停止-minio-服务","link":"#_1-停止-minio-服务","children":[]},{"level":3,"title":"2. 复制数据目录","slug":"_2-复制数据目录","link":"#_2-复制数据目录","children":[]},{"level":3,"title":"3. 确保目录权限","slug":"_3-确保目录权限","link":"#_3-确保目录权限","children":[]},{"level":3,"title":"4. 配置 MinIO 服务","slug":"_4-配置-minio-服务","link":"#_4-配置-minio-服务","children":[]},{"level":3,"title":"5. 启动 MinIO 服务","slug":"_5-启动-minio-服务","link":"#_5-启动-minio-服务","children":[]},{"level":3,"title":"6. 验证数据","slug":"_6-验证数据","link":"#_6-验证数据","children":[]},{"level":3,"title":"示例恢复过程","slug":"示例恢复过程","link":"#示例恢复过程","children":[]},{"level":3,"title":"总结","slug":"总结","link":"#总结","children":[]}],"git":{"updatedTime":1720536662000,"contributors":[{"name":"asus","email":"939943844@qq.com","commits":1}]},"filePathRelative":"blog/minio/Minio-集群冷备数据如何恢复部署.md"}')}}]);